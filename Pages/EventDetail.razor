@page "/events/{Id:int}"

@using Models

@inject Services.IEventService EventService
@inject NavigationManager Nav
@inject EventStateContainer State

@if (isLoading)
{
    <p>Loading event details...</p>
}
else if (eventItem is null)
{
    <div class="alert alert-warning mb-5">
        <p>Event not found.</p>
        <button class="btn btn-secondary" @onclick="GoBack">Back</button>
    </div>
}
else
{
    <div class="event-detail-container mb-5">

        <img src="@eventItem.ImageUrl" alt="@eventItem.ImageAlt" class="event-detail-image" />

        <h2>@eventItem.Name</h2>

        <p><strong>Date:</strong> @eventItem.Date.ToString("dddd, dd MMM yyyy")</p>
        <p><strong>Location:</strong> @eventItem.Location</p>

        @if (!string.IsNullOrWhiteSpace(eventItem.Description))
        {
            <p>@eventItem.Description</p>
        }

        <NavLink class="btn btn-primary" href=@{
        String.Format("events/{0}/register", Id)
        }
>Register</NavLink>

    <button class="btn btn-secondary ms-2" @onclick="GoBack">
        Back
    </button>

    <NavLink class="btn btn-success ms-2" href=@{
    String.Format("events/{0}/attendees", Id)
        }
    >
        <span>Go to Attendees</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
        </svg>
    </NavLink>
</div>
}

<style>
    .event-detail-container {
        max-width: 768px;
        margin: 0 auto;
    }

    .event-detail-image {
        width: 100%;
        max-height: 350px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
</style>

@code {
    [Parameter] public int Id { get; set; }

    private Event? eventItem;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        eventItem = await EventService.GetEventByIdAsync(Id);
        State.CurrentEvent = eventItem;
        isLoading = false;
    }

    private void GoBack()
    {
        Nav.NavigateTo($"{Nav.BaseUri}events");
    }
}